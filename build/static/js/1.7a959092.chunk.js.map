{"version":3,"sources":["tonva/entry/res/login.ts","tonva/entry/res/register.ts","tonva/entry/tools.tsx","tonva/entry/register.tsx","tonva/entry/login.tsx"],"names":["loginRes","_","a","registerRes","logo","__webpack_require__","tonvaTop","ui","loginTop","react","className","src","senders","type","caption","regex","getSender","un","find","v","test","register_RegisterController","[object Object]","this","accountPageCaption","accountLabel","accountSubmitCaption","passwordPageCaption","passwordSubmitCaption","successText","openVPage","register_AccountPage","account","register_VerifyPage","register_PasswordPage","register_RegSuccess","userApi","login","user","pwd","password","guest","then","retUser","tslib_es6","undefined","logined","alert","registerReturn","msg","ret","isExists","error","accountError","setVerify","toVerify","params","nick","country","mobile","mobileCountry","email","verify","Number","register","clear","toSuccess","regReturn","register_ForgetController","resetPassword","schema","name","required","maxLength","res","Object","page","header","controller","style","marginLeft","marginRight","uiSchema","onButtonClick","onSubmit","onEnter","requiredFlag","context","clearContextErrors","value","getValue","sender","setError","length","checkAccount","items","widget","label","placeholder","openPage","onVerifyChanged","prev","setDisabled","onChanged","submit","disabled","checkVerify","toPassword","typeText","extra","values","form","data","rePwd","execute","setValue","onClick","login_Login","username","console","log","token","props","callback","clickReg","start","clickForget","footer","color","margin","withBack"],"mappings":"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","file":"static/js/1.7a959092.chunk.js","sourcesContent":["import { Res } from '../../ui';\n\nexport interface LoginRes {\n    a: string;\n}\n\nexport const loginRes: Res<LoginRes> = {\n    _: {\n        a: 'd',\n    }\n}\n","import { Res } from '../../ui';\n\nexport interface RegisterRes {\n    a: string;\n}\n\nexport const registerRes: Res<RegisterRes> = {\n    _: {\n        a: 'd',\n    }\n}\n","import * as React from 'react';\nimport { nav, mobileRegex, emailRegex } from '../ui';\n\nconst logo = require('../img/logo.svg');\n\nexport function tonvaTop() {\n    return nav.loginTop(<div className=\"d-flex align-items-center\">\n        <img className=\"App-logo h-3c position-absolute\" src={logo} />\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary mr-3\">同</span>\n            <span className=\"text-danger\">花</span>\n        </div>\n    </div>);\n}\n\ninterface Sender {\n    type: string;\n    caption: string;\n    regex: RegExp;\n}\n\nconst senders:Sender[] = [\n    {type:'mobile', caption:'手机号', regex: mobileRegex},\n    {type:'email', caption:'邮箱', regex: emailRegex}\n];\n\nexport function getSender(un: string):Sender {\n    let sender = senders.find(v => v.regex.test(un) === true);\n    return sender;\n}","import * as React from 'react';\nimport {nav, Page, Schema, UiSchema, UiTextItem, UiPasswordItem, UiButton, Form, Context, resLang, StringSchema, Controller, VPage, UiCustom, UiInputItem, NumSchema, View} from '../ui';\nimport { userApi, RegisterParameter } from './userApi';\nimport '../css/va-form.css';\nimport { RegisterRes, registerRes } from './res';\nimport { tonvaTop, getSender } from './tools';\n\nexport interface Values {\n    user: string;\n    pwd: string;\n    rePwd: string;\n    country?: string;\n    mobile?: string;\n    email?: string;\n}\n/*\nclass AccountInput extends TextWidget {\n    @observable private buttonDisabled: boolean = true;\n    private onClick = () => {\n        let {onButtonClick} = this.context.form.props;\n        if (onButtonClick === undefined) return;\n        onButtonClick(this.name, this.context);\n    }\n    protected onChange(evt: React.ChangeEvent<any>) {\n        this.buttonDisabled = (evt.target.value.trim().length === 0);\n    }\n    render() {\n        return <>\n            <div className=\"input-group\">\n                <input ref={input=>this.input = input}\n                            className=\"form-control\"\n                            type={this.inputType}\n                            defaultValue={this.value}\n                            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\n                            placeholder='手机号/邮箱'\n                            readOnly={this.readOnly}\n                            disabled={this.disabled}\n                            onKeyDown = {this.onKeyDown}\n                            onFocus = {(evt: React.FocusEvent<any>) => this.onFocus(evt)}\n                            onBlur={(evt: React.FocusEvent<any>) => this.onBlur(evt)}\n                            maxLength={(this.itemSchema as StringSchema).maxLength} />\n                <div className=\"input-group-append\">\n                    <button className=\"btn btn-sm btn-outline-primary\"\n                        type=\"button\" disabled={this.buttonDisabled}\n                        onClick={this.onClick}>\n                        <small>发送验证码</small>\n                    </button>\n                </div>\n            </div>\n            {this.renderErrors()}\n        </>;\n    }\n}\n*/\nexport class RegisterController extends Controller {\n    account: string;\n    type:'mobile'|'email';\n    password: string;\n    verify: string;\n\n    accountPageCaption = '注册账号';\n    accountLabel = '注册账号';\n    accountSubmitCaption = '注册新账号'; \n    passwordPageCaption = '账号密码';\n    passwordSubmitCaption = '注册新账号'; \n    successText = '注册成功';\n\n    protected async internalStart() {\n        this.openVPage(AccountPage);\n    }\n\n    toVerify(account:string) {\n        this.account = account;\n        this.openVPage(VerifyPage);\n    }\n\n    toPassword() {\n        this.openVPage(PasswordPage);\n    }\n\n    toSuccess() {\n        this.openVPage(RegSuccess);\n    }\n\n    login() {\n        userApi\n            .login({user: this.account, pwd: this.password, guest: nav.guest})\n            .then(async retUser => {\n                if (retUser === undefined) {\n                    alert('something wrong!');\n                    return;\n                }\n                await nav.logined(retUser);\n            });\n    }\n\n    regReturn(registerReturn:number):string {\n        let msg:any;\n        switch (registerReturn) {\n            default: throw 'unknown return';\n            case 0:\n                return;\n            case 1:\n                msg = '用户名 ' + this.account;\n                break;\n            case 2:\n                msg = '手机号 +' + this.account;\n                break;\n            case 3:\n                msg = '邮箱 ' + this.account;\n                break;\n        }\n        return msg + ' 已经被注册过了';\n    }\n\n    async checkAccount():Promise<string> {\n        let ret = await userApi.isExists(this.account);\n        let error = this.accountError(ret);\n        if (error !== undefined) return error;\n        ret = await userApi.setVerify(this.account, this.type);\n        this.toVerify(this.account);\n        return;\n    }\n\n    protected accountError(isExists: number) {\n        if (isExists > 0) return '已经被注册使用了';\n    }\n\n    async execute() {\n        let params: RegisterParameter = {\n            nick: undefined,\n            user: this.account, \n            pwd: this.password,\n            country: undefined,\n            mobile: undefined,\n            mobileCountry: undefined,\n            email: undefined,\n            verify: this.verify\n        }\n        switch (this.type) {\n            case 'mobile':\n                params.mobile = Number(this.account);\n                params.mobileCountry=86;\n                break;\n            case 'email':\n                params.email = this.account;\n                break;\n        }\n        let ret = await userApi.register(params);\n        if (ret === 0) {\n            nav.clear();\n            this.toSuccess();\n            return;\n        }\n        return this.regReturn(ret);\n    }\n}\n\nexport class ForgetController extends RegisterController {\n    accountPageCaption = '密码找回';\n    accountLabel = '账号';\n    accountSubmitCaption = '注册新账号'; \n    passwordPageCaption = '重置密码';\n    passwordSubmitCaption = '提交'; \n    successText = '成功修改密码';\n\n    async execute() {\n        let ret = await userApi.resetPassword(this.account, this.password, this.verify, this.type);\n        nav.clear();\n        this.toSuccess();\n        return undefined;\n    }\n\n    protected accountError(isExists: number) {\n        if (isExists === 0) return '请输入正确的账号';\n    }\n}\n\nclass AccountPage extends VPage<RegisterController> {\n    private schema: Schema = [\n        {name: 'user', type: 'string', required: true, maxLength: 100} as StringSchema,\n        {name: 'verify', type: 'submit'},\n    ]\n    private uiSchema: UiSchema;\n\n    protected res: RegisterRes = resLang(registerRes);\n    async open() {\n        this.uiSchema = {\n            items: {\n                user: {\n                    widget: 'text',\n                    label: this.controller.accountLabel,\n                    placeholder: '手机号或邮箱',\n                } as UiTextItem, \n                verify: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '发送验证码'} as UiButton,\n            }\n        }\n                \n            this.openPage(this.page);\n    }\n\n    private page = ():JSX.Element => {\n        return <Page header={this.controller.accountPageCaption}>\n            <div className=\"w-max-20c my-5 py-5\"\n                style={{marginLeft:'auto', marginRight:'auto'}}>\n                {tonvaTop()}\n                <div className=\"h-3c\" />\n                <Form schema={this.schema} uiSchema={this.uiSchema} \n                    onButtonClick={this.onSubmit}\n                    onEnter={this.onEnter} \n                    requiredFlag={false} />\n            </div>\n        </Page>;\n    }\n\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\n        context.clearContextErrors();\n        let user = 'user';\n        let value = context.getValue(user);\n        let sender = getSender(value);\n        if (sender === undefined) {\n            context.setError(user, '必须是手机号或邮箱');\n            return;\n        }\n        let type:'mobile'|'email' = sender.type as 'mobile'|'email';\n        if (type === 'mobile') {\n            if (value.length !== 11 || value[0] !== '1') {\n                context.setError(user, '请输入正确的手机号');\n                return;\n            }\n        }\n        this.controller.account = value;\n        this.controller.type = type;\n        let ret = await this.controller.checkAccount();\n        if (ret !== undefined) context.setError(user, ret);\n    }\n\n    private onEnter = async (name:string, context:Context):Promise<string> => {\n        if (name === 'user') {\n            return await this.onSubmit('verify', context);\n        }\n    }\n}\n\nclass VerifyPage extends VPage<RegisterController> {\n    private schema: Schema = [\n        {name: 'verify', type: 'number', required: true, maxLength: 6} as NumSchema,\n        {name: 'submit', type: 'submit'},\n    ]\n\n    private onVerifyChanged = (context:Context, value:any, prev:any) => {\n        context.setDisabled('submit', !value || (value.length != 6));\n    }\n    private uiSchema: UiSchema = {\n        items: {\n            verify: {\n                widget: 'text',\n                label: '验证码',\n                placeholder: '请输入验证码',\n                onChanged: this.onVerifyChanged,\n            } as UiTextItem, \n            submit: {\n                widget: 'button', \n                className: 'btn btn-primary btn-block mt-3', \n                label: '下一步 >',\n                disabled: true\n            } as UiButton,\n        }\n    }\n    async open() {\n        this.openPage(this.page);\n    }\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\n        let verify = this.controller.verify = context.getValue('verify');\n        let ret = await userApi.checkVerify(this.controller.account, verify);\n        if (ret === 0) {\n            context.setError('verify', '验证码错误');\n            return;\n        }\n        this.controller.toPassword();\n    }\n\n    private onEnter = async (name:string, context:Context):Promise<string> => {\n        if (name === 'verify') {\n            return await this.onSubmit('submit', context);\n        }\n    }\n    private page = ():JSX.Element => {\n        let typeText:string, extra:any;\n        switch (this.controller.type) {\n            case 'mobile': typeText = '手机号'; break;\n            case 'email': \n                typeText = '邮箱'; \n                extra = <><span className=\"text-danger\">注意</span>: 有可能误为垃圾邮件，请检查<br/></>;\n                break;\n        }\n        return <Page header=\"验证码\">\n            <div className=\"w-max-20c my-5 py-5\"\n                style={{marginLeft:'auto', marginRight:'auto'}}>\n                验证码已经发送到{typeText}<br/>\n                <div className=\"py-2 px-3 my-2 text-primary bg-light\"><b>{this.controller.account}</b></div>\n                {extra}\n                <div className=\"h-1c\" />\n                <Form schema={this.schema} uiSchema={this.uiSchema} \n                    onButtonClick={this.onSubmit} \n                    onEnter={this.onEnter}\n                    requiredFlag={false} />\n            </div>\n        </Page>\n    }\n}\n\nclass PasswordPage extends VPage<RegisterController> {\n    private schema: Schema = [\n        {name: 'pwd', type: 'string', required: true, maxLength: 100} as StringSchema,\n        {name: 'rePwd', type: 'string', required: true, maxLength: 100} as StringSchema,\n        {name: 'submit', type: 'submit'},\n    ]\n    private uiSchema: UiSchema;\n    async open() {\n        this.uiSchema = {\n            items: {\n                pwd: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\n                rePwd: {widget: 'password', placeholder: '重复密码', label: '重复密码'} as UiPasswordItem,\n                submit: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: this.controller.passwordSubmitCaption} as UiButton,\n            }\n        }\n        this.openPage(this.page);\n    }\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\n        let values = context.form.data;\n        let {pwd, rePwd} = values;\n        if (!pwd || pwd !== rePwd) {\n            context.setValue('pwd', '');\n            context.setValue('rePwd', '');\n            return '密码错误，请重新输入密码！';\n        }\n        this.controller.password = pwd;\n        return await this.controller.execute();\n    }\n    private onEnter = async (name:string, context:Context):Promise<string> => {\n        if (name === 'rePwd') {\n            return await this.onSubmit('submit', context);\n        }\n    }\n    private page = ():JSX.Element => {\n        return <Page header={this.controller.passwordPageCaption}>\n            <div className=\"w-max-20c my-5 py-5\"\n                style={{marginLeft:'auto', marginRight:'auto'}}>\n                注册账号<br/>\n                <div className=\"py-2 px-3 my-2 text-primary bg-light\"><b>{this.controller.account}</b></div>\n                <div className=\"h-1c\" />\n                <Form schema={this.schema} uiSchema={this.uiSchema}                    \n                    onButtonClick={this.onSubmit}\n                    onEnter={this.onEnter}\n                    requiredFlag={false} />\n            </div>\n        </Page>\n    }\n}\n\nclass RegSuccess extends VPage<RegisterController> {\n    async open() {\n        this.openPage(this.page);\n    }\n\n    private page = () => {\n        const {account, successText, login} = this.controller;\n        return (\n        <Page header={false}>\n            <div className=\"container w-max-30c\">\n                <form className=\"my-5\">\n                    <div className=\"py-5\">\n                        账号 <strong className=\"text-primary\">{account} </strong> {successText}！\n                    </div>\n                    <button className=\"btn btn-success btn-block\" type=\"button\" onClick={login}>\n                        直接登录\n                    </button>\n                </form>\n            </div>\n        </Page>\n        );\n    }\n}\n","import * as React from 'react';\nimport {nav, Page, Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, resLang, StringSchema} from '../ui';\nimport { RegisterController, ForgetController } from './register';\nimport { userApi } from './userApi';\nimport { LoginRes, loginRes } from './res';\nimport { tonvaTop, getSender } from './tools';\nimport { User } from '../user';\n\nconst schema: Schema = [\n    {name: 'username', type: 'string', required: true, maxLength: 100} as StringSchema,\n    {name: 'password', type: 'string', required: true, maxLength: 100} as StringSchema,\n    {name: 'login', type: 'submit'},\n];\n\nexport interface LoginProps {\n    withBack?: boolean;\n    callback?: (user:User) => Promise<void>;\n    //top?: any;\n}\n\nexport default class Login extends React.Component<LoginProps> {\n    private res: LoginRes = resLang(loginRes);\n    private uiSchema: UiSchema = {\n        items: {\n            username: {placeholder: '手机/邮箱/用户名', label: '登录账号'} as UiTextItem,\n            password: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\n            login: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录'} as UiButton,\n        }\n    }\n\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\n        let values = context.form.data;\n        let un = values['username'];\n        let pwd = values['password'];\n        if (pwd === undefined) {\n            return 'something wrong, pwd is undefined';\n        }\n        let user = await userApi.login({\n            user: un,\n            pwd: pwd,\n            guest: nav.guest,\n        });\n\n        if (user === undefined) {\n            let sender = getSender(un);\n            let type:string = sender !== undefined? sender.caption : '用户名';\n            return type + '或密码错！';\n        }\n        console.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\n        await nav.logined(user, this.props.callback);\n    }\n    private onEnter = async (name:string, context:Context):Promise<string> => {\n        if (name === 'password') {\n            return await this.onSubmit('login', context);\n        }\n    }\n    private clickReg = () => {\n        //nav.replace(<RegisterView />);\n        let register = new RegisterController(undefined);\n        register.start();\n    }\n    private clickForget = () => {\n        let forget = new ForgetController(undefined);\n        forget.start();\n    }\n    render() {\n        let footer = <div className='text-center'>\n            <button className=\"btn btn-link\" color=\"link\" style={{margin:'0px auto'}}\n                onClick={this.clickReg}>\n                注册账号\n            </button>\n        </div>;\n        let header:string|boolean|JSX.Element = false;\n        if (this.props.withBack === true) {\n            header = '登录';\n        }\n        return <Page header={header} footer={footer}>\n            <div className=\"d-flex h-100 flex-column justify-content-center align-items-center\">\n                <div className=\"flex-fill\" />\n                <div className=\"w-20c\">\n                    {tonvaTop()}\n                    <div className=\"h-2c\" />\n                    <Form schema={schema} uiSchema={this.uiSchema} \n                        onButtonClick={this.onSubmit} \n                        onEnter={this.onEnter}\n                        requiredFlag={false} />\n                    <button className=\"btn btn-link btn-block\"\n                        onClick={() => this.clickForget()}>\n                        忘记密码\n                    </button>\n                </div>\n                <div className=\"flex-fill\" />\n                <div className=\"flex-fill\" />\n            </div>\n        </Page>;\n    }\n}\n"],"sourceRoot":""}